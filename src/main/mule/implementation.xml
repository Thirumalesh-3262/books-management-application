<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<db:config name="Database_Config" doc:name="Database Config" doc:id="81439a8e-76a6-459a-aba0-e89af8880afc" >
		<db:oracle-connection host="localhost" port="1522" user="system" password="Thiru@3262" serviceName="orcl1" />
	</db:config>
	<sub-flow name="Post-Flow" doc:id="f5cf7ec6-6506-4ec0-970f-cd772560fc94" >
		<logger level="INFO" doc:name="Logger" doc:id="3c928a96-f738-4690-9f2c-c88e3b6996da" message='#["Book Records started inserting"]'/>
		<db:insert doc:id="df581346-2830-40ce-936d-33c0d156f38e" config-ref="Database_Config">
			<db:sql ><![CDATA[INSERT INTO BOOKS (BOOK_ID, TITLE, AUTHOR, GENRE, PRICE, PUBLISHER_NAME, PUBLISH_DATE, CONTACT_EMAIL, PHONE_NUMBER)
VALUES (:BOOK_ID, :TITLE, :AUTHOR, :GENRE, :PRICE, :PUBLISHER_NAME, :PUBLISH_DATE, :CONTACT_EMAIL, :PHONE_NUMBER)]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	"BOOK_ID": payload.BOOK_ID,
	"TITLE": payload.TITLE,
	"AUTHOR": payload.AUTHOR,
	"GENRE" : payload.GENRE,
	"PRICE": payload.PRICE,
	"PUBLISHER_NAME": payload.PUBLISHER_NAME,
	"PUBLISH_DATE": payload.PUBLISH_DATE,
	"CONTACT_EMAIL": payload.CONTACT_EMAIL,
	"PHONE_NUMBER": payload.PHONE_NUMBER
}]]]></db:input-parameters>
		</db:insert>
		<ee:transform doc:name="Transform Message" doc:id="9d0d67cb-ce66-4af7-ba63-f298d658e2b6">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="Get-Flow" doc:id="5ebce1a0-a335-445a-bb91-39840bc97679" >
		<logger level="INFO" doc:name="Logger" doc:id="a2ce702c-9961-41ff-a771-0a701fb4a5eb" message='#["Fetching Book Records from Database"]'/>
		<db:select doc:name="Select" doc:id="6b20eee4-d5a5-45a0-bfa5-8312d45863c7" config-ref="Database_Config">
			<db:sql ><![CDATA[select * from BOOKS where BOOK_ID =:BOOK_ID]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	"BOOK_ID": payload.BOOK_ID
}]]]></db:input-parameters>
		</db:select>
		<ee:transform doc:name="Transform Message" doc:id="a8570c76-bafc-4d53-a60f-6366ad75bb5e">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="Put-Flow" doc:id="8a196d8a-d5ea-498d-a228-66f384dea476" >
		<logger level="INFO" doc:name="Logger" doc:id="60f86818-7503-46d9-a89d-789d166c6c5e" message='#["Updating the records from database"]'/>
		<db:update doc:name="Update" doc:id="7915bed6-42b2-4a55-80e0-322ac216bb87" config-ref="Database_Config">
			<db:sql ><![CDATA[UPDATE BOOKS
SET TITLE=:TITLE, PRICE =:PRICE
WHERE BOOK_ID=:BOOK_ID]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	"TITLE": payload.TITLE,
	"PRICE": payload.PRICE,
	"BOOK_ID": attributes.queryParams.BOOK_ID
}]]]></db:input-parameters>
		</db:update>
		<ee:transform doc:name="Transform Message" doc:id="ca441022-11be-465f-a084-78d1f9426c19">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
	"Status": "Record Updated Successfully"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="Delete-Flow" doc:id="adf2635c-4f02-4e32-9098-e300fb290b75" >
		<logger level="INFO" doc:name="Logger" doc:id="2a711596-a411-4ad1-9985-10302c3769a8" message='#["Started to Delete record from Database"]'/>
		<db:delete doc:name="Delete" doc:id="9859b7fb-16fd-40c8-aff8-4bb77baa8197" config-ref="Database_Config">
			<db:sql ><![CDATA[DELETE FROM BOOKS WHERE BOOK_ID=:BOOK_ID]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	"BOOK_ID": attributes.queryParams.BOOK_ID
}]]]></db:input-parameters>
		</db:delete>
		<ee:transform doc:name="Transform Message" doc:id="40fb0c25-6827-47c8-8d3b-88374291760f">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
	"Status": "Record Deleted Successfully"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
